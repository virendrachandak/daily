XSS----1.  介绍HTML标签注入漏洞是对Web应用安全影响最大、范围最广的漏洞之一。在HTML文档生成过程中，底层代码将受到攻击者控制而且没有合适地过滤掉语法控制符的代码插入到输出中就会产生HTML标签注入漏洞。这样的漏洞错误使得控制侵入输入的人能够修改结构——即意味着——修改最后生成的文档。在实际设置中，标签注入漏洞通常会被提升用于在有漏洞的应用客户端[浏览器上下文](http://en.wikipedia.org/wiki/Same-origin_policy)中执行攻击者提供的JavaScript。跨站脚本（`Cross-site scripting`）就是这类缺陷的总称。因为其普遍性以及用于渗透（`exfiltrate`）获取任意数据、修改目标站点外观、以及盗用验证用户身份执行服务器端修改的简易型，JavaScript语言在攻击者中非常流行。因此，浏览器级别的WEB应用安全改进都集中在限制攻击者生成的脚本上。这种趋势最值得注意的例子无疑是[内容安全策略（`Content Security Policty`）](https://dvcs.w3.org/hg/content-security-policy/raw-file/tip/csp-specification.dev.html)，这种安全机制会删除在受保护HTML文档上的内联JavaScript代码，并且维护了一个可以从外部加载的脚本的白名单列表。一些相关的方法也值得注意，例如[`NoScript`插件](http://noscript.net/)、[IE](http://windows.microsoft.com/en-US/internet-explorer/products/ie-9/features/cross-site-scripting-filter)和[Chrome](http://blog.chromium.org/2010/01/security-in-depth-new-security-features.html)内置的XSS过滤器、客户端的[toStaticHTML(...) API](http://msdn.microsoft.com/en-us/library/windows/apps/hh466094.aspx)和HTML清洁器（`HTML Sanitizer`）等。本文是在CSP和其他用于防止未授权脚本执行的安全机制广泛部署的背景下，攻击者在直接脚本注入之外可以选择的基础替代方法的整理集合。2.  渗透上下文成功的XSS攻击最根本的目标之一是将针对用户的密钥从有缺陷的应用中分离出来。历史上，XSS漏洞利用都会尝试获取与通过了验证的用户会话关联的HTTP Cookie；这些token——环境授权的一种形式——可以在稍后被攻击者用于在目标站点上伪造受害人。`httponly` Cookie的引入大大的限制了这种可能——也促使流氓团体寻找粒度更细的攻击方法。在不能窃取HTTP Cookie的应用中，渗透尝试通常会以抽取以下内容为目标：  1.  **个人数据。**在webmail、论坛或者信息平台、社交网络以及购物或者网银站点这样的应用中，用户信息本身就具有巨大的价值。获取联系人列表、历史信息、或者交易记录，都可能是一次攻击的终极目标。  2. **用于防御跨站请求伪造攻击的token。**一般情况下，受害者浏览器加载的所有站点都可以自由地摸索发送到任何站点的跨域请求。因为这样的请求是使用用户的环境凭证自动替换的，因此很难和合法的用户行为请求区分开。为了防止恶意干扰，大部分网站都为GET URL和修改用户账户状态或者执行其他破坏性任务的POST请求加上了与会话相关而且不可预测的密钥——XSRF token。  3.  **承载了功能的URL。**许多现代WEB应用都会偶尔使用承载了功能的URL；常见有：邀请链接、分享链接、提供私有数据下载的链接、实现单点登录（`single sign-on flow`，SSO）的链接以及联盟登录链接等。攻击者获取了这些链接就相当于获取了访问受保护资源和受保护功能的能力；尤其是在验证流程中，这些token就相当于HTTP Cookie。  本节将展示一些攻击者能够不用执行JavaScript就获取上述数据的渗透策略。2.1 <http://lcamtuf.coredump.cx/postxss/><http://lcamtuf.blogspot.jp/2011/12/notes-about-post-xss-world.html><http://lcamtuf.blogspot.jp/2011/12/x-frame-options-or-solving-wrong.html><http://lcamtuf.coredump.cx/clickit/><https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options><http://lcamtuf.coredump.cx/clickit/><http://lcamtuf.blogspot.jp/2011/10/origin-is-forever.html><http://lcamtuf.blogspot.jp/2011/09/critical-of-severity.html><http://lcamtuf.blogspot.jp/2011/08/subtle-deadly-problem-with-csp.html>