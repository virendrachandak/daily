HTTPS安全--混合内容（`mixed content`）---> HTTPS### 介绍用户访问HTTPS页面时，他们和服务器之间的连接是通过SSL加密的，因此能够防范嗅探和中间人攻击。但是HTTPS页面如果引用了来自普通HTTP请求的内容，那么用户和服务器之间的连接就有一部分是未加密的：未加密的内容可以被嗅探到，并且被中间人攻击发起者篡改，因此整个连接也不再安全。如果一个页面符合这样的情况描述，就被称为“混合内容（`mixed content`）”页面。### 观察通过使用Firefox浏览器（版本号>=23）可以观察到网站的混合内容。打开Firefox浏览器，启动`Web Console`。通过HTTP请求加载的混合内容会以红色文字显示。如下图所示：![](https://developer.mozilla.org/files/3794/mixed_content_webconsole.jpg)要修复这些红色的错误，需要将通过HTTP请求加载的内容替换成通过HTTPS加载的内容。常见的混合内容文件类型包括`JavaScript`文件、样式文件、图片、视频和其他媒体文件等等。### 混合内容分类有两类混合内容：**混合被动/显示内容**和**混合主动内容**。它们的区别在于受到中间人攻击，内容被重写这种最坏场景下的威胁级别。被动内容情况下，威胁较小（页面会看上去有问题或者有让人误解的内容）。而主动内容的情况下，可能会引发钓鱼、敏感数据泄露、重定向到恶意站点等安全威胁。* 混合被动/显示内容（`mixed passive/display content`）混合被动/显示内容指的是在HTTPS页面上引用的通过HTTP请求加载的不能修改页面其余内容的内容。例如，攻击者可以用自己的信息或者图片来替换通过HTTP发送的图片。攻击器可以通过观察发送给用户的图片来推测出用户的行为信息；通常一个站点上的特定页面会发送一些特定的图片。攻击者只要观察到某个图片的HTTP请求，就可以确定用户正在访问的网页。**被动内容列表**以下是在HTTP请求中被认为是被动内容的资源类型列表：* [`<audio>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio)（`src`属性）* [`<img>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Img)（`src`属性）* [`<video>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)（`src`属性）* [`<object>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/object)（`<object>`通过HTTP请求的子资源）* 混合主动内容（`mixed active content`）混合主动内容是在HTTPS页面上可以访问页面其他部分的文档对象模型（`DOM——Document Object Model`）的内容。这种类型的混合内容可以修改HTTPS页面的行为，并且可以从用户窃取敏感数据。因此，除了上面描述的混合显示内容带来的风险，混合主动内容还会导致其他几种安全攻击危险。中间人攻击者可以通过混合主动内容来拦截HTTP请求的内容，然后重写响应内容，引入恶意JavaScript代码。恶意主动内容可以窃取用户的验证信息，获取用户的敏感数据，以及尝试在用户系统上安装恶意软件（例如，通过利用浏览器漏洞或者浏览器的插件）。> Firefox从23开始，会默认阻止混合主动内容（通过设置可以阻止混合显示内容）。为了让Web开发者能够更轻松地找到混合内容错误，所有被阻止的混合内容请求都会被记录到Firefox自带开发者工具中的`Web Console`的`Security`一栏。![Firefox Web Console安全日志](http://gtms04.alicdn.com/tps/i4/TB1azvlFVXXXXXiXFXXVvzZSVXX-2872-652.png)![Firefox阻止混合主动内容](https://mdn.mozillademos.org/files/5261/blocked-mixed-content-errors.png)混合内容的风险与用户访问站点的类型以及该站点所暴露数据的敏感程度有关。页面可能包含公开数据或者只对通过认证用户开放的隐私数据。如果页面是公开的而且没有关于用户的隐私数据，使用混合主动内容仍然会给攻击者提供将用户重定向到HTTP页面并且从这些站点窃取HTTP Cookie的机会。**主动内容列表**以下是HTTP请求中被认为是主动内容的类型列表：* [`<script>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script)（`src`属性）* [`<link>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link)（`href`属性，包括CSS样式表）* [`XMLHttpRequest`](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)对象请求* [`<iframe>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe)（`src`属性）* CSS中所有用到了[`url`](http://www.w3.org/TR/css3-values/#urls)值的情况（[`@font-face`](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face)，[`cursor`](https://developer.mozilla.org/en-US/docs/Web/CSS/cursor)和[`background-image`](https://developer.mozilla.org/en-US/docs/Web/CSS/background-image)等等）* `<object>`（`data`属性）### 混合内容安全风险影响![混合内容的攻击影响](http://gtms04.alicdn.com/tps/i4/TB1jjbfFVXXXXXjXFXXvIQC7VXX-1440-510.png)### 如何修复被阻止的混合内容站点避免混合内容阻止的最佳策略是通过HTTPS来提供网站的所有内容。**自己的域名**：只需要将所有资源链接的地址从`http`改为`https`。**其他域名**：使用该站点可用的HTTPS版本。也可以使用“协议相对链接”（`protocol relative links`），例如：```html<script src="//example.com/script.js" type="text/javascript"></script>```这样就可以完全忽略掉协议名称，让浏览器来使用页面正在使用的协议。### 后续推荐看下本文后面给的论文，里面列出了对一些大型网站所做的混合内容安全调查，并且特别指出了对移动浏览器的危害更大。> 使用后续的“测试站点”链接测试浏览器是否会组织不安全混合内容的加载。### 参考资料[mixed content](https://developer.mozilla.org/en-US/docs/Security/MixedContent)[How to fix a website with mixed content](https://developer.mozilla.org/en-US/docs/Security/MixedContent/How_to_fix_website_with_mixed_content)[IE protecting-consumers-from-malicious-mixed-content](http://blogs.msdn.com/b/ie/archive/2011/06/23/internet-explorer-9-security-part-4-protecting-consumers-from-malicious-mixed-content.aspx)[trying-to-end-mixed-scripting](http://googleonlinesecurity.blogspot.com/2011/06/trying-to-end-mixed-scripting.html)[stackexchange exploiting-http-content-in-https-page](https://security.stackexchange.com/questions/38893/exploiting-http-content-in-https-page)[论文：A Dangerous Mix: Large-scale analysis of mixed-content websites](http://www.securitee.org/files/mixedinc_isc2013.pdf)<http://blogs.msdn.com/b/ieinternals/archive/2009/06/22/https-mixed-content-in-ie8.aspx>[测试站点](https://ie.microsoft.com/testdrive/Browser/MixedContent/Default.html?o=1)