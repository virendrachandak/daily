如何正确部署HTTPS--->   先来介绍关于一个有趣的HTTPS的安全案例。### Firefox的HTTPS和407响应码Firefox19.0修复了[一个有趣的Bug](https://bugzilla.mozilla.org/show_bug.cgi?id=796475)：#### Bug的基本信息**描述**攻击者可以通过代理返回嵌入了脚本的407响应来禁用HTTPS。**影响的产品**    核心组件（Firefox和其他Mozilla软件使用的共享组件），包括对Web内容的处理以及Gecko、HTML、CSS、布局、DOM、脚本、图片、网络等等。一些和布局有关的问题也可能与这个Bug有关，虽然用户界面问题属于Firefox的产品问题）**组件**    HTTP网络组件。Mozilla的HTTP网络代码Bug。该组件负责处理HTTP事务，如流水线技术（pipelining）、连接管理（keep-alive）、HTTP代理，HTTP1.1版本、重定向、验证（基本验证）等问题。Bug实例：代理验证问题、HTTP循环重定向等等。#### 评论1.  Michal Zalewski> "The Tangled Web"的作者，Google员工，知名黑客，[个人站点](http://lcamtuf.coredump.cx/)似乎你们（mozilla）对HTTPS的处理有一个很糟的bug。重现步骤：配好一台TCP服务器，例如`localhost:1234`，然后让服务器读取HTTP请求并且用下面的内容响应：> `//`里是我的注释```-- snip! --HTTP/1.0  407 Burp        //HTTP1.0版本，响应状态码407，响应状态文本BurpProxy-Authenticate: basic //代理验证类型：BasicConnection: close       //连接控制：关闭Content-Type: text/html     // 响应主体内容类型为HTML文本（即最常见的网页类型）<html><h1>pwnd</h1><script>lert(location.href)</script>[...some padding...]-- snip! --```然后，将`localhost:1234`配置成HTTP和HTTPS代理（可以通过`auto-discovery`来设置）。接着，让受害者访问`https://www.paypal.com`。会弹出一个提示，但是接着的合理操作（通过按`ESC`键来关闭提示）会将代理返回的文本内容作为HTML页面内容展示，从而在`https://www.paypal.com`环境中执行脚本内容。### 参考资料[Firefox:HTTPS and response code 407](http://lcamtuf.blogspot.jp/2013/02/firefox-https-and-response-code-407.html)[Mozilla Bug](https://bugzilla.mozilla.org/show_bug.cgi?id=796475)[WPAD Protocol](https://en.wikipedia.org/wiki/Web_Proxy_Autodiscovery_Protocol)[microsoft -- automatic discovery for firewall and web proxy clients](http://technet.microsoft.com/en-us/library/cc713344.aspx)[How to Deploy HTTPS Correctly](https://www.eff.org/https-everywhere/deploying-https)[Pretty-Bad-Proxy: An Overlooked Adversary in Browser's HTTP Doployments](https://research.microsoft.com/pubs/79323/pbp-final-with-update.pdf)