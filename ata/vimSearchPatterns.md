在vim中使用正则表达式搜索
---
vim中的正则匹配搜索，又叫搜索模式（search pattern）或者正则表达式（regex）搜索。本文主要介绍在vim中如何使用search pattern来进行搜索。

### 查找整个单词(全词匹配)

例如，在个代码文件里，我们希望搜索变量`ｉ`，但是如果使用`/i`会匹配所有包含`i`的单词，例如`like`和`while`中的`i`。在vim的正则表达式中，`\<`代表一个词的开始，而`\>`代表一个词的结束。因此，要查找变量`i`，应该使用以下正则表达式：

`\<i\>`

操作顺序为：在普通模式下，按`/`进入搜索，然后输入`\<i\>`并回车。

如果希望屏幕上已经有的某个词，可以无须进入搜索模式，直接将光标移动到这个单词上，然后按`*`进行搜索，vim会自动加上`\<`和`\>`。

如果只使用一部分的话，分为为从头和在结束处的匹配。例如`\<i`匹配以`i`开头的词，而`i\>`则匹配以`i`结尾的词。

### 查找多个重复的词

有时需要查找一些重复的词，例如`this this`。可以使用下面的search pattern来查找有空白符（例如空格，制表符或者换行符）分隔的词：

`\(\<\w\+\>\)\_s*\1`

其中`\<\w\+\>`即开头`\<`，一个或多个字符`\w`结束`\>`的组合，即查找完整的一个词。`\s*`中`\s`表示空格或者制表符，而`\_s`则匹配空格，制表符和换行符。最后的`\1`表示括号里匹配到的词。`\(\)`表示转义的括号。

### 或

vim使用`\|`表示或关系。例如，希望查找所有的`red`，`green`和`blue`，应该使用下面的正则：

`red\|green\|blue`

要在全文中替换掉所有的`red`，`green`和`blue`，可以使用下面的命令：

`:%s/red\|green\|blue\|purple/g`

如果只想匹配完整的单个词`red`，而不是`bored`中的`red`，可以使用下面的正则：

`\<(red\|green\|blue)\>`

还可以直接使用上次一的搜索结果，例如下面的命令：

`:%s//purple/g`

会使用上一次搜索的结果替换成`purple`。

而`&`符号表示“所有匹配模式”（whole matched pattern，所有搜索到的内容）。例如，下面的命名为给所有的整词“green”，“red”和“purple”加上引号。

`:%s/\<\(red\|green\|blue\)\>/"&"/g`

也可以只替换掉一部分内容，例如：

`:%s/color \<\(red\|green\|blue\)\>/colored \1/g`

会将“color x”（x为“green”，“red”或者“blue”）替换为“colored x”。

### 查找一行内不分顺序的两个词

可以再一行内搜索任意顺序的两个词。例如，下面的search pattern会匹配所有包含了“red”和“blue”且不分前后顺序的行。

`.*red\&.*blue`

`\&`在vim的正则搜索中用于分隔可选项，每个可选项都会匹配相同的位置。上面正则中的两个选项为：

* `.*red`会匹配从一行开始到一行结束的所有“red”
* `.*blue`会匹配从一行开始到一行结束的所有“red”

同时包含“blude”和“red”的行才会匹配上面的正则。另一种同样效果的写法为：

`\(red.*blue\)\|\(blue.*red\)`

要查找“blue”和“red”中只有“blue”或者“red”的行，应使用下面的正则：

`.*\<red\>\&.*\<blue\>`

`\(\<red\>.*\<blue\>\)\|\(\<blue\>.*\<red\>\)`

### 查找末尾的0

下面的正则会查找数字后多余的零：

`\(\.\d\)\@<=0\+\>`

该正则不匹配“1.0”中的“0”，但是会匹配“1.000”，“1.000200”以及“1.0002000300”中的“00”。匹配结束后，`:%s///g`命令会删除所有多余的0。（参考上文所述，因为搜索正则式为空，所以会使用最近一次搜索）

*  `\@<=`检查前置的原子内容和后续内容是否匹配。

*  `0\+\>`即后续内容。

*  `\(\.\d\+\)`为前置的原子内容。

上面的正在回在词尾`\>`查找一个或多个`\+`“0”的匹配，即`0\+\>`。

> vim中的词指的是有空白字符分开的连续字符串。

### 总结

vim的正则匹配搜索被称为“search pattern”，而且比一般的正则表达式需要多做一些转义，如`\+`和`\(\)`，其余还是和标准正则很符合的。用好vim，也是可以学习programming skills。而且，可以“edit at the speed of your thought”！

### 参考资料
1.  [http://vim.wikia.com/wiki/Search_patterns](http://vim.wikia.com/wiki/Search_patterns)
