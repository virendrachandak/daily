Firefox扩展开发----##  1.安装`addon-sdk`> [参考地址](https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Installation)前提要求，需要安装：* [python](http://www.python.org/)* Firefox* SDK，[taball](https://ftp.mozilla.org/pub/mozilla.org/labs/jetpack/jetpack-sdk-latest.tar.gz)或者[zip](https://ftp.mozilla.org/pub/mozilla.org/labs/jetpack/jetpack-sdk-latest.zip)文件> sdk最新开发版的[git repo地址](https://github.com/mozilla/addon-sdk)### 1.1 **FreeBSC/Mac OS X/Linux上的安装**1.  `tar -xf addon-sdk.tar.gz`2.  `cd addon-sdk`3.  `source bin/activate`### 1.2 **在Mac上使用Hombrew安装**> [`Homebrew地址`](http://brew.sh/)`brew install mozilla-addon-sdk`### 1.3 **在Windows上安装**1.  `7z.exe x addon-sdk.zip`2.  `cd addon-sdk`3.  `bin/activate`### 检查是否安装成功运行命令：  `cfx`如果能够输出类似下面这样的信息，则说明安装成功。```Usage: cfx [options] [command]```## 2.使用`cfx`命令### 2.1 初始化一个空的扩展1.  `mkdir my-firefox-addon`2.  `cd my-firefox-addon`3.  `cfx init`### 2.2 实现扩展1.  `cd lib`2.  `vi main.js``main.js`的内容为：```javascriptvar buttons = require('sdk/ui/button/action');var tabs = require("sdk/tabs");var button = buttons.ActionButton({  id: "mozilla-link",  label: "Visit Mozilla",  icon: {    "16": "./icon-16.png",    "32": "./icon-32.png",    "64": "./icon-64.png"  },  onClick: handleClick});function handleClick(state) {  tabs.open("http://www.mozilla.org/");}```然后，`cd ../data`目录，分别运行下面的命令保存3个icon图标：1.  `curl https://mdn.mozillademos.org/files/7635/icon-16.png -o icon-16.png`2.  `curl https://mdn.mozillademos.org/files/7637/icon-32.png -o icon-32.png`3.  `curl https://mdn.mozillademos.org/files/7639/icon-64.png -o icon-64.png`> 注意：上面用到的[`action button`](https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/ui_button_action)模块只能在Firefox29及之后的版本中使用，如果是比29要老的版本，`main.js`里的内容应该改成下面这样：```javascriptvar widgets = require("sdk/widget");var tabs = require("sdk/tabs");var widget = widgets.Widget({  id: "mozilla-link",  label: "Mozilla website",  contentURL: require("sdk/self").data.url("icon-16.png"),  onClick: function() {    tabs.open("http://www.mozilla.org/");  }});```然后，运行下面的命令：`cfx run`这时会启动一个使用新`Profile`的Firefox浏览器实例。### 2.3 扩展打包接着上面的流程，在`my-firefox-addon`目录下运行：`cfx xpi`来打包扩展。### 2.4 总结* `cfx init`初始化一个空白的扩展模板目录；* `cfx run`运行安装了扩展的Firefox新实例来实验新写的扩展；* `cfx xpi`将扩展打包。> 更加全面的[`cfx`参考文档](https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/cfx)> [SDK中的高级API](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs)> [SDK中的低级API](https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs)> [更多SDK教程](https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials)### 2.5 高级技巧* 覆盖内置模块SDK会使用已安装的Firefox浏览器的内置模块，在使用`cfx run`或者`cfx xpi`运行和打包时加载的都是Firefox的内置模块。扩展开发者可以这样使用，但是对于模块开发者，就需要覆盖掉这些浏览器的内置模块了。要想覆盖Firefox内置模块，需要：  1.  使用[github仓库](https://github.com/mozilla/addon-sdk)提供的SDK；  2.  从`checkout`出来的github仓库文件地址运行[`bin/activate`](https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Installation)命令；  3.  执行命令：`cfx run -o`。这样会使用本地SDK模块，而不是Firefox中的模块。### 2.6 不运行`cfx`的开发模式因为`cfx run`在每次调用时都会重启浏览器，因此，如果需要频繁修改扩展的话，可以使用[`Extension Auto-Installer`](https://addons.mozilla.org/en-US/firefox/addon/autoinstaller/)扩展。这个扩展会监听指定端口的XPI文件并且自动进行安装。这样就可以不用重启浏览器来测试新做的修改了。具体流程如下：* 修改扩展* 运行`cfx xpi`* 将`add-on`发送到指定端口安装好上面提到的`Extension Auto-Installer`扩展后写一个自动监听的shell脚本，保存为`automate.sh`，内容如下：```shell#!/bin/bashwhile true; do  cfx xpi  wget --post-file=firefox-addon.xpi http://localhost:8888done````chmod u+x automate.sh`，然后`./automate.sh`运行shell脚本。问题是不断提示：```Connecting to localhost|127.0.0.1|:8888... failed: Connection refused.Connecting to localhost|fe80::1|:8888... failed: Connection refused.Exporting extension to firefox-addon.xpi.```什么原因呢？还没有找到答案，在mozilla的github上和他们的bugzilla上找找。。。有高手请指教一下，不胜感激涕零thks