node-inspector---# 快速开始## 安装`npm install -g node-inspector`## 启动`node-debug app.js`> `app.js`是服务器的入口程序## 调试`node-debug`命令会在默认浏览器中加载`node-inspector`。> `node-inspector`目前只支持chrome和opera，如果默认浏览器不是这两种的话，需要> 手动在这两种浏览器中打开。`node-inspector`的使用方式和chrome开发者工具（devtools）基本一样。> 参考[chrome devtools](http://code.google.com/chrome/devtools/docs/scripts.html)其他有用的资源：* StrongLoop提供的[Node Inspector文档](http://docs.strongloop.com/display/DOC/Running+Node+Inspector)* Miroslav的演讲[How to Debug Node Apps with Node Inspector](https://vimeo.com/77870960)* Danny的[视频](http://www.youtube.com/view_play_list?p=A5216AC29A41EFA8)（很有可能已经过时）* [github wiki上的起步文档](http://github.com/node-inspector/node-inspector/wiki/Getting-Started---from-scratch)（很有可能已经过时）## 功能`Blink DevTools Debugger`* 浏览源码* 设置断点（和断点条件）* 断点Step over（跳过）, step in（步进）, step out（步出）, resume (continue)（恢复）* 检查作用域，变量和对象属性* 鼠标悬停在源码的表达式上来显示其值* 编辑变量和对象属性* 断点时直接continue到某个位置* 异常断点* 启用/禁用所有断点### cool功能* `Node Inspector`使用了`WebSockets`，因此断点时不需要轮询* 远程调试* [运行代码的实时编辑——Live edit of running code](http://github.com/node-inspector/node-inspector/wiki/LiveEdit)，可以选择将文件的修改返回到文件系统* 在没有加载到V8的文件上设置断点——对于模块加载/初始化调试有用* 完全使用JavaScript开发 :)* 嵌入其他应用 - 详情请参考 [如何嵌入](https://github.com/node-inspector/node-inspector/blob/master/docs/embedding.md)### 快捷键#### Re-execute functions with "Restart Frame"```Right-click on a call frame (stack frame) in the right sidebar and select the "Restart frame" command to re-execute the current function from the beginning.```在右侧栏上的一个调用帧（`Stack Frame`）上点击右键选择“restart frame"命令来重新重头启动当前函数。<div class="markdown-body"><p>&nbsp;</p><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner">Command</div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner">Mac</div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner">Windows / Linux</div></th></tr></thead><tbody><tr><td class="confluenceTd">Next Panel</td><td class="confluenceTd">⌘]</td><td class="confluenceTd">Ctrl-]</td></tr><tr><td class="confluenceTd">Previous Panel</td><td class="confluenceTd">⌘[</td><td class="confluenceTd">Ctrl-[</td></tr><tr><td class="confluenceTd">Toggle Console</td><td class="confluenceTd">Esc</td><td class="confluenceTd">Esc</td></tr><tr><td class="confluenceTd">Focus Search Box</td><td class="confluenceTd">⌘F</td><td class="confluenceTd">Ctrl-F</td></tr><tr><td class="confluenceTd">Find Next</td><td class="confluenceTd">⌘G</td><td class="confluenceTd">Ctrl-G</td></tr><tr><td class="confluenceTd">Find Previous</td><td class="confluenceTd">⇧⌘G</td><td class="confluenceTd">Ctrl-Shift-G</td></tr></tbody></table></div><h3 id="DebuggingwithNodeInspector-Consolekeyboardshortcuts"><a class="external-link" href="https://github.com/node-inspector/node-inspector/wiki/Keyboard-Shortcuts#console" name="user-content-console" rel="nofollow"></a>Console keyboard shortcuts</h3><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner">Command</div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner">Mac</div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner">Windows / Linux</div></th></tr></thead><tbody><tr><td class="confluenceTd">Next Suggestion</td><td class="confluenceTd">Tab</td><td class="confluenceTd">Tab</td></tr><tr><td class="confluenceTd">Previous Suggestion</td><td class="confluenceTd">⇧Tab</td><td class="confluenceTd">Shift-Tab</td></tr><tr><td class="confluenceTd">Accept Suggestion</td><td class="confluenceTd">Right</td><td class="confluenceTd">Right</td></tr><tr><td class="confluenceTd">Previous Command / Line</td><td class="confluenceTd">Up</td><td class="confluenceTd">Up</td></tr><tr><td class="confluenceTd">Next Command / Line</td><td class="confluenceTd">Down</td><td class="confluenceTd">Down</td></tr><tr><td class="confluenceTd">Previous Command</td><td class="confluenceTd">⌃P</td><td class="confluenceTd">&nbsp;</td></tr><tr><td class="confluenceTd">Next Command</td><td class="confluenceTd">⌃N</td><td class="confluenceTd">&nbsp;</td></tr><tr><td class="confluenceTd">Clear History</td><td class="confluenceTd">⌘K or ⌃L</td><td class="confluenceTd">Ctrl-L</td></tr><tr><td class="confluenceTd">Execute</td><td class="confluenceTd">Return</td><td class="confluenceTd">Enter</td></tr></tbody></table></div><h3 id="DebuggingwithNodeInspector-Debuggerkeyboardshortcuts"><a class="external-link" href="https://github.com/node-inspector/node-inspector/wiki/Keyboard-Shortcuts#debugger" name="user-content-debugger" rel="nofollow"></a>Debugger keyboard shortcuts</h3><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner">Command</div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner">Mac</div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner">Windows / Linux</div></th></tr></thead><tbody><tr><td class="confluenceTd">Select Next Call Frame</td><td class="confluenceTd">⌃.</td><td class="confluenceTd">Ctrl-.</td></tr><tr><td class="confluenceTd">Select Previous Call Frame</td><td class="confluenceTd">⌃,</td><td class="confluenceTd">Ctrl-,</td></tr><tr><td class="confluenceTd">Continue</td><td class="confluenceTd">F8 or ⌘/</td><td class="confluenceTd">F8 or Ctrl-/</td></tr><tr><td class="confluenceTd">Step Over</td><td class="confluenceTd">F10 or ⌘’</td><td class="confluenceTd">F10 or Ctrl-’</td></tr><tr><td class="confluenceTd">Step Into</td><td class="confluenceTd">F11 or ⌘;</td><td class="confluenceTd">F11 or Ctrl-;</td></tr><tr><td class="confluenceTd">Step Out</td><td class="confluenceTd">⇧F11 or ⇧⌘;</td><td class="confluenceTd">Shift-F11 or Ctrl-Shift-;</td></tr><tr><td class="confluenceTd">Edit Breakpoint</td><td class="confluenceTd">⌃Click</td><td class="confluenceTd">Ctrl-Click</td></tr></tbody></table></div><p>&nbsp;</p></div>## 常见问题### 脚本运行太快，无法绑定debugger可以使用`--debug-brk`来启动被调试的进程，这样脚本会在第一行暂停。> `node-debug`默认增加了该选项。### UI很奇怪有疑问时刷新浏览器页面即可。### 是否可以远程调试？`node-inspector`必须和被调试进程在同一台机器上运行，但是浏览器可以在任何地方。只要打开的调试端口可访问就行。### 如何指定需要隐藏的文件？创建一个JSON编码的数组。在使用命令行选项时必须对引号进行转义。```$ node-inspector --hidden='["node_modules/framework"]'```> 数组元素被作为正则表达式解析### UI没有加载或者没有用而且刷新也没有用确保禁用了adblock以及其他可能阻止内容的脚本或者插件。### 是否可以（选择性地）删除debug会话元数据？例如，Node-inspector的一些函数调用的观察变量进入了坏状态（可能进入了一些特殊的c-bindings），这时候会希望能够删除调试会话元数据。这样的情况下，即使重启应用/调试会话也不能解决问题。```Node-inspector讲调试会话元数据存储再HTML5的local storage中。可以检查local storage的内容并且按需删除任何元素。在Google Chrome中，可以在JavaScript控制台中执行下面的命令：// Remove allwindow.localStorage.clear();// Or, to list keys so you can selectively remove them with removeItem()window.localStorage;// Remove all the watch expressionswindow.localStorage.removeItem('watchExpressions');// Remove all the breakpointswindow.localStorage.removeItem('breakpoints');```完成清理后，刷新浏览器即可。> 注意，这里的JavaScript控制台指的是Chrome开发者工具带的，而不是node-inspector自带的。效果如下图所示（请原谅我对用户名和项目打了码）：![](http://gtms01.alicdn.com/tps/i1/TB1zUIUFFXXXXcebXXXcEBt0pXX-1444-1194.png)### Node Inspector启动时间很长尝试设置`--no-preload`为`ture`。这个选项可以禁用启动时搜索磁盘上的`*.js`文件。### 如何调试Mocha单元测试？启动`_mocha`作为被调试的程序并确保执行在第一行暂停。这样就有足够的时间在测试运行前设置断点。```$ node-debug _mocha```### 高级用法1.  启动Node Inspector服务器`node-inspector`> 可以让服务器在后台运行，可以使用相同的服务器实例来调试多个进程。> 快捷方式：`Ctrl+Z`将正在运行的进程放入后台执行。查看当前运行的后台程序：`jobs` ，将后台运行的命令调到前台：`fg`。2.  在node进程中启用debug模式可以使用debug标记来启动node：```node --debug some-node-js-application.js```或者也可以在第一行暂停脚本：```node --debug-brk some-node-js-application.js```或者可以通过发送信号在一个已经运行的node进程上启用调试：1.  获取node进程的pid（可以使用`gpre`或者`ps -ef`）：    ```    pgrep -l node    ```2.  发送`USR1`信号    ```    kill -s USR1 2345    ```> 2345是找到的pid### windowswindows现在不支持Unix信号，要启用调试，可以使用文档里没有说明的API函数`process._debugProcess(pid)`：1.  获取node进程的PID，例如：  ```  > tasklist /FI "IMAGENAME eq node.xe"  Image name            PID       Session Name      Session#    Mem Usage  ====================  ========  ================= =========== ===========  node.exe              3084      Console                     1     11,946k  ```2.  调用API：    ```    > node -e "process._debugProcess(3084)"    ```3.  加载debugger UI在Chrome浏览器中打开<http://127.0.0.1:8080/debug?port=5858># 配置## node-debug命令行选项：```--debug-brk, -b           在第一行断点（`node --debug-brk`），默认为`true`--web-port, -p, --port    Node Inspector端口（`node-inspector --web-port={port}`）--debug-port, -d          Node/v8 debugger端口（`node --debug={port}`）--cli, -c                 CLI模式，不打开浏览器。--version, -v             打印Node Inspector的版本。--help, -h                显示本帮助。```## node-inspectornode-inspector使用[rc](https://github.com/dominictarr/rc)模块收集选项。配置项：* 命令行参数（通过`optimist`解析）* 以`node-inspector_`为前缀的环境变量* 如果传入`--config file`，那么会格式化该文件* 本地`.node-inspectorrc`或者在`./ ../ ../../ ../../../`这样的目录中查找* `$HOME/.node-inspectorrc`* `$HOME/.node-inspectorrc/config`* `$HOME/.config/node-inspector`* `$HOME/.config/.node-inspectorrc/config`* `/etc/node-inspectorrc`* `/etc/node-inspectorrc/config`* `config.json`中的选项用于向后兼容* Node Inspector `./lib/config.js`文件中的默认描述所有找到的配置源会被扁平化为一个对象，这样本列表前面的选项会覆盖后面的内容。在RC文件中使用破折号来明明。例如示例config文件：```{  "web-port": 8088,  "web-host": null,  "debug-port": 5858,  "save-live-edit": true,  "no-preload": true,  "hidden": [],  "stack-trace-limit": 50}```预定义选项列表：```选项                    默认          描述--help              |           | 打印关于选项的信息--web-port          | 8080      | inspector的host端口--web-host          | 127.0.0.1 | 监听的host--debug-port        | 5858      | 连接到调试应用的端口--save-live-edit    | false     | 将live edit的修改保存到磁盘（更新编辑过的文件）--preload           | true      | 预加载`*.js`文件。可以禁用该选项来加快启动--hidden            | []        | 从UI中隐藏的文件数组（这些文件上的断点会被忽略）--stack-trace-limit | 50        | 一个断点上现实的stack frame的数量```### 参考资料* StrongLoop提供的[Node Inspector文档](http://docs.strongloop.com/display/DOC/Running+Node+Inspector)* Miroslav的演讲[How to Debug Node Apps with Node Inspector](https://vimeo.com/77870960)* Danny的[视频](http://www.youtube.com/view_play_list?p=A5216AC29A41EFA8)（很有可能已经过时）* [github wiki上的起步文档](http://github.com/node-inspector/node-inspector/wiki/Getting-Started---from-scratch)（很有可能已经过时）* [http://strongloop.com/strongblog/announcing-a-new-and-improved-node-js-debugger/](http://strongloop.com/strongblog/announcing-a-new-and-improved-node-js-debugger/)* [http://greenido.wordpress.com/2013/08/27/debug-nodejs-like-a-pro/](http://greenido.wordpress.com/2013/08/27/debug-nodejs-like-a-pro/)* [http://www.nowherenearithaca.com/2013/12/setting-up-debugging-of-chrome-devtools.html](http://www.nowherenearithaca.com/2013/12/setting-up-debugging-of-chrome-devtools.html)* [https://developer.mozilla.org/en-US/docs/Tools/Debugger](https://developer.mozilla.org/en-US/docs/Tools/Debugger)* [http://visionmedia.github.io/mocha/](http://visionmedia.github.io/mocha/)