将VIM打造成Python IDE---* 介绍* 基本编辑和调试  * 代码折叠  * 窗口拆分  * 代码片段  * 任务列表  * 修改历史* 语法高亮和验证  * Pep8* tab补全及文档* 代码导航  * 缓存  * 模糊文本文件查找  * 文件浏览器  * 重构并跳转到定义  * 搜索* 与Git集成* 测试集成  * django nose  * py.test* virtualenv* django* 建议----> 太长，没时间读> ```> git clone https://github.com/sontek/dotfiles.git> cd dotfiles> ./install.sh vim> ```# 介绍将为python设置好的vim配置在github上存储好，按以下步骤进行：```mkdir ~/.vim/mkdir ~/.vim/{autoload, bundle}cd ~/.vim/git init```作者使用[pathogen](https://github.com/tpope/vim-pathogen)管理vim插件，因此需要在vimrc中加入下面的内容：```filetype offcall pathogen#runtime_append_all_bundles()call pathongen#helptags()```然后将vim插件作为git submodule加入git仓库中：```git submodule add http://github.com/tpope/vim-fugitive.git bundle/fugitivegit submodule add https://github.com/msanders/snipmate.vim.git bundle/snipmategit submodule add https://github.com/tpope/vim-surround.git bundle/surroundgit submodule add https://github.com/tpope/vim-git.git bundle/gitgit submodule add https://github.com/ervandew/supertab.git bundle/supertabgit submodule add https://github.com/sontek/minibufexpl.vim.git bundle/minibufexplgit submodule add https://github.com/wincent/Command-T.git bundle/command-tgit submodule add https://github.com/mitechie/pyflakes-pathogen.gitgit submodule add https://github.com/mileszs/ack.vim.git bundle/ackgit submodule add https://github.com/sjl/gundo.vim.git bundle/gundogit submodule add https://github.com/fs111/pydoc.vim.git bundle/pydocgit submodule add https://github.com/vim-scripts/pep8.git bundle/pep8git submodule add https://github.com/alfredodeza/pytest.vim.git bundle/py.testgit submodule add https://github.com/reinh/vim-makegreen bundle/makegreengit submodule add https://github.com/vim-scripts/TaskList.vim.git bundle/tasklistgit submodule add https://github.com/vim-scripts/The-NERD-tree.git bundle/nerdtreegit submodule add https://github.com/sontek/rope-vim.git bundle/ropevimgit submodule initgit submodule updategit submodule foreach git submodule initgit submodule foreach git submodule update```# 基本编辑和调试## 代码折叠先启用代码折叠，这样可以更加轻松地阻止代码并且隐藏正在处理的不感兴趣的部分。对于Python这样做非常容易，因为需要空白。在`~/.vimrc`文件中加入下面内容：```set foldmethod=indentset foldlevel=99```这样就可以在一个方法里使用`za`来根据代码缩进折叠和展开代码了。## 窗口拆分有时候代码折叠还不够，需要同时打开多个窗口并且同时编辑多个不同文件夹里的多个文件。多窗口操作的快捷键为：```垂直拆分：       Ctrl+w+v水平拆分：       Ctrl+w+s关闭当前窗口：   Ctrl+w+q```为了减少按键，还可以做以下键位绑定：```map <c-j> <c-w>jmap <c-k> <c-w>kmap <c-l> <c-w>lmap <c-h> <c-w>h```![](http://i.imgur.com/krj0l.png)## 代码片段使用snipmate插件可以实现代码片段功能。也可以创建自己的代码片段添加到自定义代码片段中：```mkdir ~/.vim/snippetsvim ~/.vim/snippets/python.snippets```在打开的vim编辑窗口中输入以下内容并保存：```snippet pdb  import pdb; pdb.set_trace()```## 任务列表另一种有用的方法是将代码标记为`TODO`和`FIXME`。可以通过插件`tasklist`实现，然后在`~/.vimrc`中加入以下键映射：`map <leader>td <Plug>TaskList`## 修改历史`Gundo`插件可以查看每次保存的文件内容，从而快速比较并且在不同的保存之间切换。![](http://i.imgur.com/2NrPS.png)在`~/.vimrc`中加入以下键映射：`map <leader>g :GundoToggle<CR>`# 语法高亮和验证在`~/.vimrc`中加入以下内容：```syntax on                 " syntax highlightingfiletype on               " try to detect filetypesfiletype plugin indent on " enable loading file for filetype```加入以上配置并且启用`pyflakes`插件后，就可以收到python的语法错误提示和警告了。如果不希望使用`quickfix`窗口提示，可以加入下面的配置内容：`let g:pyflakes_use_quickfix = 0`![](http://i.imgur.com/ZfjFe.png)## Pep8最后一个有用的插件是`pep8`，它可以确保所有项目的代码都是一致的。在`~/.vimrc`中加入下面的键绑定，这样就可以在`quickfix`窗口中快速跳到有pep8冲突的地方：`let g:pep8_map='<leader>8'`![](http://i.imgur.com/VU9AB.png)# tab补全及文档vim有多重不同代码补全选项，可以使用`SuperTab`插件来检查正在使用的代码的上下文并从中选择。在`~/.vimrc`中加入以下配置：```au FileType python set omnifunc=pythoncomplete#Completelet g:SuperTabDefaultCompletionType = "context"```接着，只需要启用菜单和`pydoc`预览来获取代码补全的最有用信息了：`set completeopt=menuone,longest,preview`![](http://i.imgur.com/g4lxP.png)也可以在所有submodule开始启用pydoc，这样就可以在光标上按`<leader>pw`键来打开新窗口查看光标处模块的文档了。# 代码导航## 缓存要想理解Vim的代码导航，最重要的是完全理解缓存（`buffers`）的使用。通过`minibufexpl`插件可以方便地看到打开的buffer的内容。当然，也可以使用命令`:buffers`查看。通过使用`b<number>`来在打开的不同buffer之间跳转。其中`<number>`对应打开的buffer的数字（不用输`<`和`>`）。数字也可以换成buffer的名称。在github上有多个`minibufexpl`插件，推荐使用[作者修补过的版本](https://github.com/sontek/minibufexpl)。要关闭一个打开的buffer，可以使用命令`:bd`或者`:bw`。## 模糊文本文件查找使用`command-t`插件，需要进行编译，按照以下步骤做：```cd ~/.vim/bundle/Command-T/rake make```默认情况下`Commant-T`绑定到了`<leader>t`快捷键。也可以只在打开的buffer中查找，使用快捷键`<leader>b`。![](http://i.imgur.com/hUcSl.png)## 文件浏览器`NERDTree`是vim强大的项目文件浏览器。![](http://i.imgur.com/R4ZzQ.png)## 重构并跳转到定义`Ropevim`可以帮助代码导航，它支持插入`import`语句，`goto`定义，重构以及代码补全。例如在使用django时将光标置于类模型上，然后调用`:RopeGotoDefinition`命令，就会跳转到django库中这个类的定义位置。可以加上如下键绑定：```map <leader>j :RopeGotoDefinition<CR>map <leader>r :RopeRename<CR>```## 搜索使用`Ack`（这是一款类似于grep但是比grep要强大的工具）。可以做如下绑定：`nmap <leader>a <Esc>:Ack!`# 与Git集成`Git.vim`提供了git配置文件的语法高亮功能，fugitive提供了与git的交互接口，包括`diff`，`status`，`commit`，`mv`等等。Fugitive插件还可以帮助我们查看目前所在的分支，在`~/.vimrc`中加入如下内容：`%{fugitive#statusline()}`一些非常有用的命令：* **Gblame**：一行行查看代码的最近一次修改者。* **Gwrite**：将文件放入`staging`区域准备提交，基本上等于`git add xxx`。* **Gread**：等于`git checkout xxx`。* **Gcommit**：等于`git commit`。可以利用vim命令行的历史功能来使用最近的提交信息，也可以通过`+`和`-`来添加和删除要提交的文件。![](http://i.imgur.com/NuRRj.png)# 测试集成## django nose使用`MakeGreen`插件，加入以下绑定：`map <leader>dt :set makeprg=python\ manage.py\ test\|:call MakeGreen()<CR>`如果测试通过，会显示绿色状态栏，测试失败则显示红色状态栏。## py.test`py.test`插件功能更强大，包括按类、文件或者方法来执行单独的测试，可以在各个断言错误之间循环，绑定如下：```" Execute the testsnmap <silent><Leader>tf <Esc>:Pytest file<CR>nmap <silent><Leader>tc <Esc>:Pytest class<CR>nmap <silent><Leader>tm <Esc>:Pytest method<CR>" Cycle through test errorsnmap <silent><Leader>tn <Esc>:Pytest next<CR>nmap <silent><Leader>tp <Esc>:Pytest previous<CR>nmap <silent><Leader>te <Esc>:Pytest error<CR>```![](http://i.imgur.com/RAE7v.png)# virtualenv要想提供库代码补全，在`~/.vimrc`中加入如下内容：```" Add the virtualenv's site-packages to vim pathpy << EOFimport os.pathimport sysimport vimif 'VIRTUAL_ENV' in os.environ:  project_base_dir = os.environ['VIRTUAL_ENV']  sys.path.insert(0, project_base_dir)  activate_this = os.path.join(project_base_dir, 'bin/activate_this.py')  execfile(activate_this, dict(__file__=activate_this))```# django在打开vim直接`export`环境变量`DJANGO_SETTINGS_MODULE`以实现django模块的代码补全：`export DJANGO_SETTINGS_MODULE=project.settings`# 建议想要更丰富的colorscheme，可以参考[这个地址](http://code.google.com/p/vimcolorschemetest/)。### 参考资料<http://www.sontek.net/blog/2011/05/07/turning_vim_into_a_modern_python_ide.html>